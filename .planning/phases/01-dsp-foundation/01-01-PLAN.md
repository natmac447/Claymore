---
phase: 01-dsp-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - CMakeLists.txt
  - Source/PluginProcessor.h
  - Source/PluginProcessor.cpp
  - Source/PluginEditor.h
  - Source/PluginEditor.cpp
  - Source/Parameters.h
autonomous: true
requirements:
  - DIST-01
  - DIST-02
  - DIST-03
  - DIST-04
  - DIST-05
  - DIST-06
  - SIG-01
  - SIG-02
  - SIG-03
  - SIG-04
  - SIG-05

must_haves:
  truths:
    - "CMake configure and build succeeds for VST3 and AU targets on macOS"
    - "JUCE 8.0.12 is fetched via FetchContent during configure"
    - "All 11 APVTS parameters exist with correct ranges and defaults"
    - "Plugin binary is produced and can be scanned by a DAW host"
  artifacts:
    - path: "CMakeLists.txt"
      provides: "JUCE 8.0.12 FetchContent, plugin target with VST3+AU formats"
      contains: "juce_add_plugin"
    - path: "Source/Parameters.h"
      provides: "ParamIDs namespace and createParameterLayout() factory"
      exports: ["ParamIDs", "createParameterLayout"]
    - path: "Source/PluginProcessor.h"
      provides: "AudioProcessor subclass with APVTS"
      contains: "juce::AudioProcessorValueTreeState apvts"
    - path: "Source/PluginProcessor.cpp"
      provides: "Processor implementation with prepareToPlay/processBlock stubs"
      contains: "processBlock"
    - path: "Source/PluginEditor.h"
      provides: "Minimal editor returning GenericAudioProcessorEditor"
      contains: "GenericAudioProcessorEditor"
  key_links:
    - from: "Source/PluginProcessor.cpp"
      to: "Source/Parameters.h"
      via: "createParameterLayout() call in APVTS constructor"
      pattern: "createParameterLayout"
    - from: "CMakeLists.txt"
      to: "Source/*.cpp"
      via: "target_sources listing"
      pattern: "target_sources"
---

<objective>
Create the JUCE 8 project scaffold: CMake build system with FetchContent for JUCE 8.0.12, the complete APVTS parameter layout (all 11 parameters with correct ranges and defaults), and the PluginProcessor/PluginEditor shell that compiles and produces a loadable plugin binary.

Purpose: Establishes the build infrastructure and parameter contract that all subsequent DSP and wiring work depends on. Nothing else can compile without this.
Output: A compilable JUCE plugin project that loads in a DAW (passes audio through, no processing yet).
</objective>

<execution_context>
@/Users/nathanmcmillan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathanmcmillan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-dsp-foundation/01-CONTEXT.md
@.planning/phases/01-dsp-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CMakeLists.txt with JUCE 8.0.12 FetchContent and plugin target</name>
  <files>CMakeLists.txt</files>
  <action>
Create `CMakeLists.txt` at project root with:

1. `cmake_minimum_required(VERSION 3.25)` and `project(Claymore VERSION 1.0.0)`
2. FetchContent for JUCE 8.0.12:
   ```cmake
   FetchContent_Declare(JUCE
       GIT_REPOSITORY https://github.com/juce-framework/JUCE.git
       GIT_TAG        8.0.12
       GIT_SHALLOW    TRUE)
   FetchContent_MakeAvailable(JUCE)
   ```
3. `juce_add_plugin(Claymore ...)` with these exact settings:
   - COMPANY_NAME "Nathan McMillan"
   - PLUGIN_MANUFACTURER_CODE NMcM
   - PLUGIN_CODE Clyr
   - FORMATS VST3 AU (no Standalone, no CLAP)
   - PRODUCT_NAME "Claymore"
   - IS_SYNTH FALSE, NEEDS_MIDI_INPUT FALSE, NEEDS_MIDI_OUTPUT FALSE, IS_MIDI_EFFECT FALSE
   - EDITOR_WANTS_KEYBOARD_FOCUS FALSE
   - COPY_PLUGIN_AFTER_BUILD TRUE
   - VST3_CATEGORIES "Fx" "Distortion"
   - AU_MAIN_TYPE kAudioUnitType_Effect
   - BUNDLE_ID com.nathanmcmillan.claymore
4. Explicit `target_sources(Claymore PRIVATE ...)` listing all Source files (NOT GLOB_RECURSE):
   - Source/PluginProcessor.cpp
   - Source/PluginEditor.cpp
5. `target_compile_definitions` with JUCE_WEB_BROWSER=0, JUCE_USE_CURL=0, JUCE_VST3_CAN_REPLACE_VST2=0, JUCE_DISPLAY_SPLASH_SCREEN=0
6. `target_link_libraries` PRIVATE: juce::juce_audio_utils, juce::juce_audio_processors, juce::juce_dsp; PUBLIC: juce::juce_recommended_config_flags, juce::juce_recommended_lto_flags, juce::juce_recommended_warning_flags
7. C++17 standard: `target_compile_features(Claymore PRIVATE cxx_std_17)`

Do NOT use GLOB_RECURSE for sources. Do NOT add Standalone format. Do NOT add juce_gui_extra or juce_opengl modules.
  </action>
  <verify>
    <automated>cd /Users/nathanmcmillan/Projects/Claymore && cmake -B build -G "Xcode" -DCMAKE_OSX_ARCHITECTURES="arm64;x86_64" 2>&1 | tail -5</automated>
    <manual>CMake configure completes without errors; JUCE is fetched</manual>
  </verify>
  <done>CMakeLists.txt exists, cmake configure succeeds, JUCE 8.0.12 is downloaded via FetchContent</done>
</task>

<task type="auto">
  <name>Task 2: Create Parameters.h, PluginProcessor, and PluginEditor with complete APVTS layout</name>
  <files>
Source/Parameters.h
Source/PluginProcessor.h
Source/PluginProcessor.cpp
Source/PluginEditor.h
Source/PluginEditor.cpp
  </files>
  <action>
**Parameters.h** — Create at `Source/Parameters.h`:

1. `ParamIDs` namespace with `inline constexpr const char*` for all 11 parameter IDs:
   - drive, symmetry, tightness, sag, tone, presence (distortion)
   - inputGain, outputGain, mix, gateEnabled, gateThreshold (signal chain)
2. Free function `juce::AudioProcessorValueTreeState::ParameterLayout createParameterLayout()` that creates all parameters:
   - Drive: NormalisableRange(0.0f, 1.0f, 0.01f), default 0.5f, label "Drive"
   - Symmetry: NormalisableRange(0.0f, 1.0f, 0.01f), default 0.0f, label "Symmetry"
   - Tightness: NormalisableRange(0.0f, 1.0f, 0.01f), default 0.0f, label "Tightness"
   - Sag: NormalisableRange(0.0f, 1.0f, 0.01f), default 0.0f, label "Sag"
   - Tone: NormalisableRange(0.0f, 1.0f, 0.01f), default 0.5f, label "Tone"
   - Presence: NormalisableRange(0.0f, 1.0f, 0.01f), default 0.5f, label "Presence"
   - Input Gain: NormalisableRange(-24.0f, 24.0f, 0.1f), default 0.0f, label "dB", name "Input Gain"
   - Output Gain: NormalisableRange(-48.0f, 12.0f, 0.1f), default 0.0f, label "dB", name "Output Gain"
   - Mix: NormalisableRange(0.0f, 1.0f, 0.01f), default 1.0f, label "Mix"
   - Gate Enabled: AudioParameterBool, default false, name "Gate"
   - Gate Threshold: NormalisableRange(-60.0f, -10.0f, 0.1f), default -40.0f, label "dB", name "Gate Threshold"

**PluginProcessor.h/.cpp** — Create `ClaymoreProcessor` extending `juce::AudioProcessor`:

1. Constructor initializes APVTS with `createParameterLayout()`
2. `isBusesLayoutSupported()` accepts mono-in/mono-out AND stereo-in/stereo-out (standard mixing plugin pattern)
3. `prepareToPlay()`: cache all 11 `std::atomic<float>*` parameter pointers via `apvts.getRawParameterValue(ParamIDs::xxx)`, set `isInitialized = true`
4. `processBlock()`: guard with `isInitialized` (clear buffer and return if false), then pass audio through unchanged (no processing yet — DSP comes in Plan 02-03)
5. `getStateInformation()` / `setStateInformation()`: APVTS copyState/replaceState XML pattern (from GunkLord)
6. All standard AudioProcessor overrides: getName() returns "Claymore", acceptsMidi() false, producesMidi() false, getTailLengthSeconds() 0.0, getNumPrograms() 1, etc.
7. Private members: `juce::AudioProcessorValueTreeState apvts`, `std::atomic<bool> isInitialized { false }`, all 11 cached `std::atomic<float>*` param pointers initialized to nullptr

**PluginEditor.h/.cpp** — Minimal:

1. `ClaymoreEditor` extending `juce::AudioProcessorEditor`
2. Constructor sets size (400, 300) and creates a `juce::GenericAudioProcessorEditor` as child component
3. `resized()` gives the generic editor full bounds
4. This is Phase 1 only — Phase 3 replaces this with the real pedal-style GUI

Register the processor factory: `juce::AudioProcessor* JUCE_CALLTYPE createPluginFilter()` returning `new ClaymoreProcessor()`
  </action>
  <verify>
    <automated>cd /Users/nathanmcmillan/Projects/Claymore && cmake --build build --config Debug --target Claymore_VST3 2>&1 | tail -10</automated>
    <manual>Build succeeds; VST3 binary produced in build output</manual>
  </verify>
  <done>All 11 APVTS parameters have correct ranges and defaults; plugin compiles as VST3 and AU; PluginProcessor has cached atomic param pointers; GenericAudioProcessorEditor shows all parameters; state save/restore implemented</done>
</task>

</tasks>

<verification>
1. `cmake -B build -G "Xcode"` completes without errors
2. `cmake --build build --config Debug --target Claymore_VST3` produces a .vst3 bundle
3. `cmake --build build --config Debug --target Claymore_AU` produces a .component bundle
4. Parameter count in APVTS matches 11 (6 distortion + 5 signal chain)
5. All parameter IDs, ranges, and defaults match the specification exactly
</verification>

<success_criteria>
- JUCE 8.0.12 fetched and linked via FetchContent
- Plugin compiles for both VST3 and AU on macOS (Universal Binary)
- All 11 parameters defined with exact ranges from REQUIREMENTS.md and CONTEXT.md extensions
- Plugin produces a loadable binary (passes audio through unprocessed)
- State save/restore works via APVTS XML
</success_criteria>

<output>
After completion, create `.planning/phases/01-dsp-foundation/01-01-SUMMARY.md`
</output>
