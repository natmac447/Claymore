---
phase: 03-gui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - CMakeLists.txt
  - Assets/Fonts/CormorantGaramond-Light.ttf
  - Assets/Fonts/DMSans-Regular.ttf
  - Assets/Fonts/DMSans-Light.ttf
  - Assets/Logos/cairn-makers-mark.svg
  - Source/look/ClaymoreTheme.h
  - Source/look/ClaymoreTheme.cpp
  - Source/gui/OversamplingSelector.h
autonomous: true
requirements:
  - GUI-01
  - GUI-02

must_haves:
  truths:
    - "ClaymoreTheme is a compilable LookAndFeel_V4 subclass with drawRotarySlider painting white matte knobs with silver indicator lines and cold blue arc fills"
    - "Cormorant Garamond and DM Sans fonts are embedded as BinaryData and loadable via Typeface::createSystemTypefaceFor"
    - "OversamplingSelector is a compilable Component that wraps 3 radio buttons linked to an AudioParameterChoice via ParameterAttachment"
    - "CMakeLists.txt builds a ClaymoreAssets BinaryData target from the Assets/ directory and links it to Claymore"
  artifacts:
    - path: "Source/look/ClaymoreTheme.h"
      provides: "LookAndFeel_V4 subclass with Cairn color tokens, custom drawRotarySlider, drawToggleButton, LED drawing helper"
      contains: "class ClaymoreTheme"
    - path: "Source/look/ClaymoreTheme.cpp"
      provides: "ClaymoreTheme implementation — knob rendering, font caching, grain texture generation"
      contains: "drawRotarySlider"
    - path: "Source/gui/OversamplingSelector.h"
      provides: "Custom 3-button radio group component for oversampling rate selection"
      contains: "class OversamplingSelector"
    - path: "CMakeLists.txt"
      provides: "juce_add_binary_data for ClaymoreAssets, target_link_libraries includes ClaymoreAssets"
      contains: "juce_add_binary_data"
  key_links:
    - from: "Source/look/ClaymoreTheme.cpp"
      to: "ClaymoreAssets BinaryData"
      via: "Typeface::createSystemTypefaceFor with BinaryData font arrays"
      pattern: "ClaymoreAssets::"
    - from: "Source/gui/OversamplingSelector.h"
      to: "APVTS oversampling parameter"
      via: "ParameterAttachment with beginGesture/setValueAsPartOfGesture/endGesture"
      pattern: "ParameterAttachment"
---

<objective>
Build the visual foundation for Claymore's pedal-style GUI: the custom LookAndFeel theme, embedded font/logo assets, grain texture generator, and the OversamplingSelector custom component.

Purpose: Establishes all reusable visual pieces so Plan 02 can wire them into the editor without any rendering or asset concerns.
Output: Compilable ClaymoreTheme, OversamplingSelector, and BinaryData asset pipeline. No editor changes yet.
</objective>

<execution_context>
@/Users/nathanmcmillan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathanmcmillan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-gui/03-RESEARCH.md
@Source/Parameters.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Asset pipeline — download fonts, copy SVG, configure CMake BinaryData</name>
  <files>
    CMakeLists.txt
    Assets/Fonts/CormorantGaramond-Light.ttf
    Assets/Fonts/DMSans-Regular.ttf
    Assets/Fonts/DMSans-Light.ttf
    Assets/Logos/cairn-makers-mark.svg
  </files>
  <action>
1. Create `Assets/Fonts/` and `Assets/Logos/` directories in the project root.

2. Download Google Fonts TTF files:
   - Cormorant Garamond Light: download from Google Fonts API (https://fonts.google.com/specimen/Cormorant+Garamond — use the `google-fonts` download URL pattern or `curl` from GitHub mirror `https://github.com/google/fonts/raw/main/ofl/cormorantgaramond/CormorantGaramond-Light.ttf`)
   - DM Sans Regular: `https://github.com/google/fonts/raw/main/ofl/dmsans/DMSans%5Bopsz%2Cwght%5D.ttf` — however, DM Sans variable font won't work cleanly with JUCE. Instead, get the static weights: DM Sans Regular and DM Sans Light from the `static/` directory of the Google Fonts repo, or use the GitHub download URLs.
   - Alternative approach if variable fonts cause issues: use `https://github.com/google/fonts/raw/main/ofl/dmsans/static/DMSans-Regular.ttf` and `https://github.com/google/fonts/raw/main/ofl/dmsans/static/DMSans-Light.ttf`
   - Save to `Assets/Fonts/` as: `CormorantGaramond-Light.ttf`, `DMSans-Regular.ttf`, `DMSans-Light.ttf`

3. Copy the Cairn makers-mark SVG from the brand directory:
   - Source: `~/projects/brand/Logos/cairn-makers-mark.svg`
   - Destination: `Assets/Logos/cairn-makers-mark.svg`

4. Update `CMakeLists.txt` to add a BinaryData target and link it:
   ```cmake
   # After juce_add_plugin(...) block, before target_sources:

   # Embedded assets — fonts and logos for GUI
   juce_add_binary_data(ClaymoreAssets
       NAMESPACE ClaymoreAssets
       SOURCES
           Assets/Fonts/CormorantGaramond-Light.ttf
           Assets/Fonts/DMSans-Regular.ttf
           Assets/Fonts/DMSans-Light.ttf
           Assets/Logos/cairn-makers-mark.svg
   )
   ```

5. Add new source files to `target_sources`:
   ```cmake
   target_sources(Claymore PRIVATE
       Source/PluginProcessor.cpp
       Source/PluginEditor.cpp
       Source/look/ClaymoreTheme.cpp
   )
   ```
   Note: OversamplingSelector.h is header-only, no .cpp needed.

6. Add `ClaymoreAssets` to `target_link_libraries`:
   ```cmake
   target_link_libraries(Claymore
       PRIVATE
           ClaymoreAssets
           juce::juce_audio_utils
           juce::juce_audio_processors
           juce::juce_dsp
       PUBLIC
           juce::juce_recommended_config_flags
           juce::juce_recommended_lto_flags
           juce::juce_recommended_warning_flags
   )
   ```

7. Verify the font files are non-empty TTF files (check file size > 10KB each).
  </action>
  <verify>
    <automated>cd /Users/nathanmcmillan/Projects/Claymore && test -f Assets/Fonts/CormorantGaramond-Light.ttf && test -f Assets/Fonts/DMSans-Regular.ttf && test -f Assets/Fonts/DMSans-Light.ttf && test -f Assets/Logos/cairn-makers-mark.svg && grep -q "juce_add_binary_data" CMakeLists.txt && grep -q "ClaymoreAssets" CMakeLists.txt && echo "PASS: Assets and CMake configured"</automated>
    <manual>Check that font files are valid (non-zero size) and CMake BinaryData section is correctly placed</manual>
  </verify>
  <done>All three font files exist in Assets/Fonts/, SVG exists in Assets/Logos/, CMakeLists.txt has juce_add_binary_data for ClaymoreAssets and links it to Claymore target, new source files listed in target_sources</done>
</task>

<task type="auto">
  <name>Task 2: ClaymoreTheme LookAndFeel + OversamplingSelector component</name>
  <files>
    Source/look/ClaymoreTheme.h
    Source/look/ClaymoreTheme.cpp
    Source/gui/OversamplingSelector.h
  </files>
  <action>
Create the custom LookAndFeel and the oversampling selector component.

**Source/look/ClaymoreTheme.h:**

Declare `class ClaymoreTheme : public juce::LookAndFeel_V4` with:
- Constructor that sets all Cairn colour IDs (Slider::rotarySliderFillColourId = cold blue `#4a7cb5`, Slider::rotarySliderOutlineColourId = Cairn `#5c5147`, Slider::thumbColourId = white), loads fonts via BinaryData, caches Typeface::Ptr members, generates grain texture
- `void drawRotarySlider(...)` override — custom knob rendering
- `void drawToggleButton(...)` override — flip-toggle switch rendering for Gate Enabled
- `void drawLabel(...)` override — DM Sans uppercase labels below knobs
- Public helpers:
  - `juce::Font getTitleFont (float height)` — returns Cormorant Garamond at specified height
  - `juce::Font getLabelFont (float height)` — returns DM Sans Regular at specified height
  - `juce::Font getValueFont (float height)` — returns DM Sans Light at specified height
  - `static void drawLEDIndicator (juce::Graphics& g, juce::Rectangle<float> bounds, bool isActive)` — radial glow LED with ColourGradient bloom for bypass state
  - `const juce::Image& getGrainTexture() const` — returns cached grain Image for tiling in paint()
  - `static juce::Image generateGrainTexture (int w, int h, float opacity)` — one-time noise grain generation (128x128 tile, ARGB, low-opacity noise)
- Private members:
  - `juce::Typeface::Ptr cormorantTypeface, dmSansTypeface, dmSansLightTypeface`
  - `juce::Image grainTexture`

**Cairn Color Tokens** (as constexpr or named constants in the header or a nested namespace):

| Token | Hex | Purpose |
|-------|-----|---------|
| background | `0xff1c1a1f` | Basalt + blue shift |
| surface | `0xff2a2523` | Hearth — elevated panels |
| border | `0xff5c5147` | Zone separators (use at 10-15% alpha) |
| labelText | `0xffb8b0a5` | Lichen — knob labels |
| primaryText | `0xffd8d3cc` | Bone — title, values |
| accent | `0xff4a7cb5` | Cold blue steel |
| knobBody | `0xffe8e4df` | Off-white matte |
| indicator | `0xffc8c8c8` | Silver metallic |
| makersMark | `0xff5c5147` | At 25% alpha for footer |

**Source/look/ClaymoreTheme.cpp:**

Implement `drawRotarySlider` following the pattern in RESEARCH.md:
1. Calculate radius, centre, angle from parameters
2. Draw knob body — filled ellipse with `knobBody` color (`#e8e4df`)
3. Draw subtle rim shadow — 1.5px stroke with `0x30000000`
4. Draw silver indicator line — narrow rectangle rotated to `angle`, filled with `indicator` color (`#c8c8c8`). Line extends from center outward ~60% of radius.
5. Draw inactive arc track — full 270° arc just outside the knob, stroked with `border` at 40% alpha, 2px stroke
6. Draw active arc fill — arc from `rotaryStartAngle` to current `angle`, stroked with `accent` color (`#4a7cb5`), 2px stroke

Implement `drawToggleButton` for a metallic flip-toggle switch:
1. Draw a vertical pill/capsule shape (rounded rect, ~16x30px proportional to bounds)
2. If toggle ON: silver metallic fill on top half, dark on bottom half
3. If toggle OFF: dark on top half, silver on bottom half
4. Use `indicator` color for the silver portions, `surface` for dark
5. Subtle 1px border with `border` color at low alpha

Implement `drawLabel` override: Use DM Sans Regular, uppercase, `labelText` color, centered. Only draw text (no background fill).

Implement font helper methods using JUCE 8 FontOptions API:
```cpp
juce::Font ClaymoreTheme::getTitleFont (float height)
{
    return juce::Font { juce::FontOptions{}
        .withTypeface (cormorantTypeface)
        .withHeight (height) };
}
```
(Same pattern for getLabelFont and getValueFont with their respective typefaces.)

Implement `generateGrainTexture`: Create a 128x128 ARGB Image, iterate pixels with juce::Random, set each pixel to `Colour(v, v, v).withAlpha(opacity * 0.08f)` where v is a random 0-255 byte. Return the Image. Call this once in the constructor and store in `grainTexture` member.

Implement `drawLEDIndicator` static method:
1. If active: draw radial ColourGradient from `accent` at ~40% alpha to transparent, fill expanded ellipse (glow bloom, 8px expansion)
2. Draw LED bulb core — filled ellipse with bright cold blue (`#6fb3f0` if active, `surface` if inactive)
3. Draw subtle rim — 1px stroke with `border` at low alpha

**Source/gui/OversamplingSelector.h:**

Header-only component. Declare `class OversamplingSelector : public juce::Component`:
- Constructor takes `juce::AudioProcessorValueTreeState& apvts`
- Creates 3 `juce::TextButton` instances ("2x", "4x", "8x") in a radio group (setRadioGroupId)
- Creates a `juce::ParameterAttachment` bound to `ParamIDs::oversampling`
- The ParameterAttachment callback calls a private `updateButtons(float normValue)` method that maps normalized value to button index (idx = juce::roundToInt(normValue * 2.0f)) and sets toggle state
- Each button's onClick lambda calls `attachment.beginGesture()`, `attachment.setValueAsPartOfGesture((float)idx / 2.0f)`, `attachment.endGesture()` — where idx is the button's index (0, 1, 2)
- `resized()` lays out the 3 buttons horizontally with equal width, small gap between them
- Call `attachment.sendInitialUpdate()` at end of constructor to sync initial state
- Include `Source/Parameters.h` for `ParamIDs::oversampling`

CRITICAL ordering: Create the TextButtons and call addAndMakeVisible BEFORE creating the ParameterAttachment, since sendInitialUpdate will fire the callback which accesses the buttons.

The buttons should use `setClickingTogglesState(true)` so they behave as radio toggles visually. Style them with a custom `drawButtonBackground` or rely on the LookAndFeel — the parent editor will set the LookAndFeel before this component paints.

Add `#include "Source/Parameters.h"` (adjust path as needed — the include path from gui/ to Parameters.h is `"../Parameters.h"`).
  </action>
  <verify>
    <automated>cd /Users/nathanmcmillan/Projects/Claymore && cmake -B build -G Xcode 2>&1 | tail -20 && cmake --build build --config Release --target Claymore 2>&1 | tail -30 | grep -E "(error|BUILD|warning:)" | head -20 && echo "VERIFY COMPLETE"</automated>
    <manual>Inspect that ClaymoreTheme.h declares all Cairn color tokens and ClaymoreTheme.cpp implements drawRotarySlider with white matte knob + silver indicator + cold blue arc</manual>
  </verify>
  <done>ClaymoreTheme compiles with drawRotarySlider, drawToggleButton, drawLEDIndicator, font helpers, grain texture. OversamplingSelector compiles with 3-button radio group linked to APVTS oversampling parameter via ParameterAttachment. Full project builds without errors.</done>
</task>

</tasks>

<verification>
1. `cmake -B build -G Xcode` succeeds with ClaymoreAssets binary data target generated
2. `cmake --build build --config Release --target Claymore` compiles without errors
3. Source/look/ClaymoreTheme.h exists and declares class ClaymoreTheme : public juce::LookAndFeel_V4
4. Source/look/ClaymoreTheme.cpp exists and contains drawRotarySlider implementation
5. Source/gui/OversamplingSelector.h exists and contains class OversamplingSelector with ParameterAttachment
6. All 3 font files exist in Assets/Fonts/ with valid sizes
7. cairn-makers-mark.svg exists in Assets/Logos/
8. CMakeLists.txt contains juce_add_binary_data(ClaymoreAssets ...) and ClaymoreAssets in target_link_libraries
</verification>

<success_criteria>
- ClaymoreTheme, OversamplingSelector, and BinaryData asset pipeline compile cleanly as part of the Claymore target
- No new compiler warnings related to the added source files
- Font BinaryData symbols (ClaymoreAssets::CormorantGaramond_Light_ttf etc.) are resolvable at link time
</success_criteria>

<output>
After completion, create `.planning/phases/03-gui/03-01-SUMMARY.md`
</output>
