---
phase: 03-gui
plan: 02
type: execute
wave: 2
depends_on:
  - "03-01"
files_modified:
  - Source/PluginEditor.h
  - Source/PluginEditor.cpp
autonomous: false
requirements:
  - GUI-01
  - GUI-02
  - GUI-03

must_haves:
  truths:
    - "All 10 knobs (Drive, Symmetry, Tightness, Sag, Tone, Presence, Input Gain, Output Gain, Mix, Gate Threshold) are visible as labeled rotary controls and respond to mouse drag"
    - "Drive knob is visually larger than satellite knobs, centered in the Primary Zone as the hero control"
    - "Gate Enabled toggle is visible and functional as a flip-switch style control"
    - "Oversampling selector shows 2x/4x/8x buttons with the current rate highlighted"
    - "LED bypass indicator in the header glows cold blue when plugin is active"
    - "CLAYMORE title is rendered in Cormorant Garamond with steel-etched treatment in the header"
    - "Cairn 4-zone layout is visible: Header, Primary, Utility, Footer with subtle zone separators"
    - "Powder-coated grain texture is visible on the pedal body surface"
    - "All parameters accept DAW automation write and read correctly — knobs visually track automation playback"
    - "Plugin window is 700x500px fixed size, HiDPI/Retina aware"
  artifacts:
    - path: "Source/PluginEditor.h"
      provides: "Complete ClaymoreEditor class with all Slider/Attachment members, OversamplingSelector, zone Rectangles"
      contains: "class ClaymoreEditor"
    - path: "Source/PluginEditor.cpp"
      provides: "Editor constructor (attachments, knob setup, layout), paint() (grain, zones, title, LED, makers-mark), resized() (4-zone layout)"
      contains: "ClaymoreEditor::ClaymoreEditor"
  key_links:
    - from: "Source/PluginEditor.h"
      to: "Source/look/ClaymoreTheme.h"
      via: "ClaymoreTheme member, setLookAndFeel in constructor, setLookAndFeel(nullptr) in destructor"
      pattern: "ClaymoreTheme theme"
    - from: "Source/PluginEditor.cpp"
      to: "APVTS parameters"
      via: "SliderAttachment for all 10 continuous params + ButtonAttachment for gateEnabled"
      pattern: "SliderAttachment.*apvts"
    - from: "Source/PluginEditor.cpp"
      to: "Source/gui/OversamplingSelector.h"
      via: "std::make_unique<OversamplingSelector> constructed with apvts"
      pattern: "OversamplingSelector"
    - from: "Source/PluginEditor.cpp"
      to: "ClaymoreAssets BinaryData"
      via: "Drawable::createFromImageData for cairn-makers-mark SVG"
      pattern: "ClaymoreAssets::cairn"
---

<objective>
Rebuild ClaymoreEditor from the GenericAudioProcessorEditor stub into the full pedal-style GUI with Cairn 4-zone layout, Drive-centric knob arrangement, all APVTS attachments, and visual polish.

Purpose: Delivers the complete user-facing interface — the plugin becomes fully usable from the GUI with all parameters visible, interactive, and automatable.
Output: PluginEditor.h/.cpp fully replaced. Plugin opens with the designed pedal interface.
</objective>

<execution_context>
@/Users/nathanmcmillan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathanmcmillan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-gui/03-RESEARCH.md
@.planning/phases/03-gui/03-CONTEXT.md
@.planning/phases/03-gui/03-01-SUMMARY.md
@Source/Parameters.h
@Source/PluginProcessor.h
@Source/look/ClaymoreTheme.h
@Source/gui/OversamplingSelector.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite ClaymoreEditor — full pedal-style GUI with 4-zone layout and all APVTS attachments</name>
  <files>
    Source/PluginEditor.h
    Source/PluginEditor.cpp
  </files>
  <action>
Completely replace the GenericAudioProcessorEditor stub with the full custom GUI.

**Source/PluginEditor.h:**

Remove the `genericEditor` unique_ptr. Replace with:

```cpp
#pragma once
#include <juce_audio_utils/juce_audio_utils.h>
#include "PluginProcessor.h"
#include "look/ClaymoreTheme.h"
#include "gui/OversamplingSelector.h"
```

Class declaration for `ClaymoreEditor final : public juce::AudioProcessorEditor`:
- Constructor: `explicit ClaymoreEditor (ClaymoreProcessor&)`
- Destructor: calls `setLookAndFeel(nullptr)` — REQUIRED to clear dangling pointer before ClaymoreTheme member is destroyed
- `void paint (juce::Graphics&) override`
- `void resized() override`

Private members in THIS EXACT ORDER (destruction order is critical — attachments AFTER sliders):

1. `ClaymoreProcessor& processor`
2. `ClaymoreTheme theme` — LookAndFeel member, same lifetime as editor
3. Zone rectangles: `juce::Rectangle<int> headerZone, primaryZone, utilityZone, footerZone`
4. Cairn makers-mark Drawable: `std::unique_ptr<juce::Drawable> makersMark`
5. ALL Sliders (declared before attachments):
   - `juce::Slider driveKnob, symmetryKnob, tightnessKnob, sagKnob`
   - `juce::Slider toneKnob, presenceKnob`
   - `juce::Slider inputGainKnob, outputGainKnob, mixKnob`
   - `juce::Slider gateThresholdKnob`
6. `juce::ToggleButton gateEnabledButton`
7. Labels (juce::Label for each knob name — DM Sans uppercase, centered below knob):
   - `juce::Label driveLabel, symmetryLabel, tightnessLabel, sagLabel`
   - `juce::Label toneLabel, presenceLabel`
   - `juce::Label inputGainLabel, outputGainLabel, mixLabel`
   - `juce::Label gateThresholdLabel, gateLabel`
8. ALL Attachments (declared AFTER sliders — C++ reverse destruction order):
   ```cpp
   using SliderAttachment = juce::AudioProcessorValueTreeState::SliderAttachment;
   using ButtonAttachment = juce::AudioProcessorValueTreeState::ButtonAttachment;
   SliderAttachment driveAttach, symmetryAttach, tightnessAttach, sagAttach;
   SliderAttachment toneAttach, presenceAttach;
   SliderAttachment inputGainAttach, outputGainAttach, mixAttach, gateThresholdAttach;
   ButtonAttachment gateEnabledAttach;
   ```
9. `std::unique_ptr<OversamplingSelector> oversamplingSelector`
10. `JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (ClaymoreEditor)`

**Source/PluginEditor.cpp — Constructor:**

Initialize all attachments in the member initializer list (each takes `(apvts, ParamIDs::xxx, xxxKnob)`):
```cpp
ClaymoreEditor::ClaymoreEditor (ClaymoreProcessor& p)
    : AudioProcessorEditor (p),
      processor (p),
      driveAttach      (p.apvts, ParamIDs::drive,         driveKnob),
      symmetryAttach   (p.apvts, ParamIDs::symmetry,      symmetryKnob),
      tightnessAttach  (p.apvts, ParamIDs::tightness,     tightnessKnob),
      sagAttach        (p.apvts, ParamIDs::sag,           sagKnob),
      toneAttach       (p.apvts, ParamIDs::tone,          toneKnob),
      presenceAttach   (p.apvts, ParamIDs::presence,      presenceKnob),
      inputGainAttach  (p.apvts, ParamIDs::inputGain,     inputGainKnob),
      outputGainAttach (p.apvts, ParamIDs::outputGain,    outputGainKnob),
      mixAttach        (p.apvts, ParamIDs::mix,           mixKnob),
      gateThresholdAttach (p.apvts, ParamIDs::gateThreshold, gateThresholdKnob),
      gateEnabledAttach   (p.apvts, ParamIDs::gateEnabled,   gateEnabledButton)
{
```

In the constructor body:

1. Apply LookAndFeel: `setLookAndFeel (&theme);`

2. Configure all knobs in a loop:
   ```cpp
   for (auto* knob : { &driveKnob, &symmetryKnob, &tightnessKnob, &sagKnob,
                        &toneKnob, &presenceKnob,
                        &inputGainKnob, &outputGainKnob, &mixKnob, &gateThresholdKnob })
   {
       knob->setSliderStyle (juce::Slider::RotaryHorizontalVerticalDrag);
       knob->setTextBoxStyle (juce::Slider::NoTextBox, false, 0, 0);
       knob->setPopupDisplayEnabled (true, true, this); // value tooltip on hover
       addAndMakeVisible (knob);
   }
   ```

3. Set double-click reset defaults for each knob:
   - driveKnob: `setDoubleClickReturnValue(true, 0.5f)` (mid drive)
   - symmetryKnob: `setDoubleClickReturnValue(true, 0.0f)` (hard clip default)
   - tightnessKnob: `setDoubleClickReturnValue(true, 0.0f)`
   - sagKnob: `setDoubleClickReturnValue(true, 0.0f)`
   - toneKnob: `setDoubleClickReturnValue(true, 0.5f)` (mid tone)
   - presenceKnob: `setDoubleClickReturnValue(true, 0.5f)` (flat)
   - inputGainKnob: `setDoubleClickReturnValue(true, 0.0f)` (0 dB — value is in native dB range)
   - outputGainKnob: `setDoubleClickReturnValue(true, 0.0f)` (0 dB)
   - mixKnob: `setDoubleClickReturnValue(true, 1.0f)` (100% wet default)
   - gateThresholdKnob: `setDoubleClickReturnValue(true, -40.0f)` (default threshold)

4. Configure labels — for each knob, create a corresponding juce::Label:
   ```cpp
   auto setupLabel = [this](juce::Label& label, const juce::String& text)
   {
       label.setText (text, juce::dontSendNotification);
       label.setJustificationType (juce::Justification::centred);
       label.setFont (theme.getLabelFont (11.0f));
       label.setColour (juce::Label::textColourId, juce::Colour (0xffb8b0a5)); // Lichen
       label.setInterceptsMouseClicks (false, false);
       addAndMakeVisible (label);
   };
   setupLabel (driveLabel, "DRIVE");
   setupLabel (symmetryLabel, "SYMMETRY");
   setupLabel (tightnessLabel, "TIGHTNESS");
   setupLabel (sagLabel, "SAG");
   setupLabel (toneLabel, "TONE");
   setupLabel (presenceLabel, "PRESENCE");
   setupLabel (inputGainLabel, "INPUT");
   setupLabel (outputGainLabel, "OUTPUT");
   setupLabel (mixLabel, "MIX");
   setupLabel (gateThresholdLabel, "THRESHOLD");
   setupLabel (gateLabel, "GATE");
   ```

5. Configure gateEnabledButton:
   ```cpp
   gateEnabledButton.setButtonText ("GATE");
   addAndMakeVisible (gateEnabledButton);
   ```

6. Create OversamplingSelector:
   ```cpp
   oversamplingSelector = std::make_unique<OversamplingSelector> (p.apvts);
   addAndMakeVisible (*oversamplingSelector);
   ```

7. Load Cairn makers-mark SVG from BinaryData:
   ```cpp
   makersMark = juce::Drawable::createFromImageData (
       ClaymoreAssets::cairn_makers_mark_svg,
       ClaymoreAssets::cairn_makers_mark_svgSize);
   ```
   (Include `ClaymoreAssets.h` — the BinaryData header generated by juce_add_binary_data)

8. Set window size:
   ```cpp
   setResizable (false, false);
   setSize (700, 500);
   ```

**Destructor:**
```cpp
ClaymoreEditor::~ClaymoreEditor()
{
    setLookAndFeel (nullptr); // CRITICAL: clear before theme member is destroyed
}
```

**Source/PluginEditor.cpp — paint():**

1. Fill background with `background` color (`0xff1c1a1f`)

2. Tile grain texture over Primary zone:
   ```cpp
   auto& grain = theme.getGrainTexture();
   if (grain.isValid())
   {
       g.setTiledImageFill (grain, 0, 0, 1.0f);
       g.fillRect (primaryZone);
   }
   ```

3. Draw zone separators:
   - 1px horizontal line at bottom of headerZone with `border` at ~10% alpha
   - 1px horizontal line at top of utilityZone with `border` at ~10% alpha

4. Draw "CLAYMORE" title in headerZone:
   - Use `theme.getTitleFont (22.0f)` for Cormorant Garamond
   - Color: `primaryText` (`0xffd8d3cc`)
   - Position: left-aligned within headerZone with 16px left padding
   - Steel-etched treatment: draw text twice — first pass at 1px offset in darker color (shadow), second pass in primary text color. This gives a subtle engraved/embossed appearance.

5. Draw LED bypass indicator in headerZone:
   - Position: right side of header, ~16px from right edge, vertically centered
   - Size: approximately 10x10px ellipse
   - Always active (Claymore has no bypass toggle in v1 — the LED is always "on"). If later a bypass parameter is added, read it here.
   - Call `ClaymoreTheme::drawLEDIndicator (g, ledBounds, true)`

6. Draw Cairn makers-mark in footerZone:
   - If makersMark is valid, draw centered in footer at ~25% opacity
   - Scale to fit footer height (minus padding)
   - Use `makersMark->drawWithin (g, footerBounds, juce::RectanglePlacement::centred, opacity)`

7. Draw version text in footer:
   - "v1.0.0" right-aligned in footerZone using `theme.getValueFont (9.0f)`, `makersMark` color at 25% alpha

**Source/PluginEditor.cpp — resized():**

Implement Cairn 4-zone layout:

```cpp
void ClaymoreEditor::resized()
{
    auto bounds = getLocalBounds();

    const int headerH  = 36;
    const int footerH  = 22;
    const int utilityH = 80;

    headerZone  = bounds.removeFromTop (headerH);
    footerZone  = bounds.removeFromBottom (footerH);
    utilityZone = bounds.removeFromBottom (utilityH);
    primaryZone = bounds; // remainder (~362px)
```

**Primary Zone — Drive-centric hero layout:**

The Drive knob is large (~100-110px diameter) and centered horizontally in the primary zone, positioned in the upper portion.

Satellite knobs are smaller (~55-65px diameter) arranged around Drive:
- LEFT side (pre-distortion): Tightness, Symmetry, Input Gain, Sag — arranged as a 2x2 grid or arc flanking left of Drive
- RIGHT side (post-distortion): Tone, Presence, Gate Threshold — arranged flanking right of Drive
- Gate Enabled toggle: near Gate Threshold

Layout approach — use absolute positioning with calculated coordinates:
1. Center the Drive knob horizontally, ~30px below top of primaryZone
2. Place left satellite knobs in a 2-column arrangement to the left of Drive
3. Place right satellite knobs in a column/arrangement to the right of Drive
4. Each knob has its label positioned ~4-6px below the knob bounds

Use a helper to position a knob with its label:
```cpp
auto placeKnob = [](juce::Slider& knob, juce::Label& label, int cx, int cy, int size)
{
    knob.setBounds (cx - size / 2, cy - size / 2, size, size);
    label.setBounds (cx - size / 2 - 8, cy + size / 2 + 2, size + 16, 14);
};
```

Approximate layout (tweak exact positions for visual balance):
- Drive: center-x = 350, center-y = primaryZone.getY() + 100, size = 110
- Tightness: cx = 120, cy = primaryZone.getY() + 60, size = 60
- Symmetry: cx = 220, cy = primaryZone.getY() + 60, size = 60
- Input Gain: cx = 120, cy = primaryZone.getY() + 160, size = 60
- Sag: cx = 220, cy = primaryZone.getY() + 160, size = 60
- Tone: cx = 480, cy = primaryZone.getY() + 60, size = 60
- Presence: cx = 580, cy = primaryZone.getY() + 60, size = 60
- Gate Threshold: cx = 530, cy = primaryZone.getY() + 160, size = 60
- Gate Enabled toggle: positioned near Gate Threshold, e.g., cx = 620, cy = primaryZone.getY() + 160, size ~30x50

**Utility Zone:**

Lay out Output Gain knob, Mix knob, and OversamplingSelector horizontally across the utility zone with even spacing:
- Output Gain: left third
- Mix: center third
- Oversampling selector: right third
- Each utility knob ~50px diameter with label below
- OversamplingSelector: ~120x30px, vertically centered

**Footer Zone:** No interactive children — all painted in paint().

These are starting positions. The exact pixel values should be adjusted for visual balance. The key constraints are:
- Drive must be visually dominant (largest)
- Pre-distortion controls LEFT, post-distortion controls RIGHT
- Clear separation between zones
- Labels centered below their knobs
- Generous padding (Cairn "spacious density")
  </action>
  <verify>
    <automated>cd /Users/nathanmcmillan/Projects/Claymore && cmake --build build --config Release --target Claymore 2>&1 | tail -30 | grep -E "(error|BUILD)" | head -10 && echo "VERIFY COMPLETE"</automated>
    <manual>Open the built plugin in a DAW. Verify: (1) 700x500 window with dark background and grain texture, (2) Drive hero knob centered and large, (3) satellite knobs arranged left/right, (4) all knobs respond to mouse drag, (5) labels below each knob, (6) CLAYMORE title in header, (7) LED indicator, (8) oversampling 2x/4x/8x selector works, (9) Gate toggle works, (10) Cairn mark in footer</manual>
  </verify>
  <done>PluginEditor.h/.cpp fully replaced — GenericAudioProcessorEditor removed. ClaymoreEditor renders pedal-style GUI with 4-zone Cairn layout, Drive-centric hero knob, all 10 knobs with labels and APVTS attachments, gate toggle, oversampling selector, grain texture, CLAYMORE title, LED indicator, and makers-mark. Plugin compiles and builds.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual and functional verification in DAW</name>
  <files>Source/PluginEditor.h, Source/PluginEditor.cpp</files>
  <action>
Human verification checkpoint. Claude has built the complete pedal-style GUI:
- ClaymoreTheme LookAndFeel with custom knob rendering (white matte + silver indicator + cold blue arc)
- ClaymoreEditor with Cairn 4-zone layout, Drive hero knob, 9 satellite knobs, Gate toggle, oversampling selector
- Grain texture, CLAYMORE title with steel-etched treatment, LED bypass indicator, Cairn makers-mark

Verification steps:
1. Open the Claymore plugin in your DAW (installed via COPY_PLUGIN_AFTER_BUILD)
2. Window: Verify 700x500px fixed size, dark background with subtle grain texture
3. Header: "CLAYMORE" in Cormorant Garamond on the left, cold blue LED indicator on the right
4. Primary Zone: Large Drive knob centered with smaller satellite knobs (left: Tightness, Symmetry, Input Gain, Sag; right: Tone, Presence, Gate Threshold + Gate toggle)
5. Utility Zone: Output Gain, Mix knobs, Oversampling selector (2x/4x/8x)
6. Footer: Cairn makers-mark centered, version number right
7. Knob interaction: Drag any knob — white body with silver indicator rotates, cold blue arc fills
8. Automation: Write automation on Drive, play back — knob visually tracks the curve
9. Oversampling: Click 4x then 8x — button highlighting changes, rate switches
10. Gate: Toggle gate on/off — flip-switch responds
11. Double-click: Any knob resets to default
12. Tooltip: Hover over knob — value appears as popup
  </action>
  <verify>Human opens plugin in DAW and confirms all 12 verification steps above</verify>
  <done>User approves the visual and functional state of the GUI, or provides specific issues to address</done>
</task>

</tasks>

<verification>
1. Plugin builds successfully as Release VST3 and AU
2. Plugin window opens at 700x500px with full pedal-style GUI (no more GenericAudioProcessorEditor)
3. All 10 knobs are visible with labels and respond to mouse interaction
4. Drive knob is visually larger and centered (hero layout)
5. Oversampling selector switches between 2x/4x/8x
6. Gate toggle works
7. DAW automation write/read functions on all parameters
8. Knobs visually track automation playback
9. CLAYMORE title rendered in Cormorant Garamond in header
10. LED indicator with glow in header
11. Grain texture visible on primary zone background
12. Cairn makers-mark visible in footer
13. No crashes on editor open/close cycle (destruction order safe)
</verification>

<success_criteria>
- GUI-01: All 10 signal knobs + gate threshold visible with labels; gate toggle accessible; all respond to mouse
- GUI-02: Oversampling selector shows 2x/4x/8x with current rate highlighted; functional
- GUI-03: All parameters accept DAW automation write/read; knobs visually track automation playback
- Visual: Cairn 4-zone layout, Drive hero, pedal aesthetic, grain texture, custom knob style, LED indicator
- Stability: No crash on editor open/close in DAW; no crash on rapid parameter automation
</success_criteria>

<output>
After completion, create `.planning/phases/03-gui/03-02-SUMMARY.md`
</output>
